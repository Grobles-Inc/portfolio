---
import { Facebook, Github, Menu } from "@lucide/astro";
import { SITE_TITLE } from "../consts";

const navLinksEs = [
	{ href: "/", label: "Inicio" },
	{ href: "/about", label: "Nosotros" },
	{ href: "/services", label: "Servicios" },
	{ href: "/projects", label: "Proyectos" },
];

const navLinksEn = [
	{ href: "/en", label: "Home" },
	{ href: "/en/about", label: "About" },
	{ href: "/en/services", label: "Services" },
	{ href: "/en/projects", label: "Projects" },
];

const socialLinks = [
	{
		href: "https://www.facebook.com/profile.php?id=61573124294121",
		label: "Facebook",
		icon: Facebook,
	},
	{
		href: "https://github.com/Grobles-Inc",
		label: "GitHub",
		icon: Github,
	},
];

const currentLocale = Astro.currentLocale || "en";
const navLinks = currentLocale === "es" ? navLinksEs : navLinksEn;
---

<div class="drawer drawer-start">
	<input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
	<div class="drawer-content flex flex-col">
		<!-- Navbar -->
		<header
			id="main-header"
			class="navbar bg-primary fixed top-0 z-50 w-full transition-transform duration-300"
		>
			<div
				class="max-w-7xl mx-auto w-full px-4 flex flex-row justify-between items-center"
			>
				<!-- Navbar Start: Logo -->
				<div class="navbar-start">
					<a
						href={currentLocale === "es" ? "/" : "/en"}
						aria-label="Grobles Home"
						class="flex items-center"
					>
						<img
							src="/grobles.png"
							alt="Grobles Logo"
							class="size-14 rounded-lg object-cover"
							loading="lazy"
							decoding="async"
						/>
						<span class="font-bold text-xl font-poppins text-base-content">
							{SITE_TITLE}
						</span>
					</a>
				</div>

				<!-- Navbar Center: Desktop Navigation -->
				<div class="navbar-center hidden lg:flex flex-1 justify-center">
					<ul class="flex gap-2">
						{
							navLinks.map(({ href, label }) => (
								<li>
									<a
										href={href}
										class={`px-4 py-2 font-medium transition-colors ${
											Astro.url.pathname === href
												? "btn btn-secondary btn-active text-white"
												: "btn btn-ghost "
										}`}
										aria-current={
											Astro.url.pathname === href ? "page" : undefined
										}
									>
										{label}
									</a>
								</li>
							))
						}
					</ul>
				</div>

				<!-- Navbar End: Desktop Actions & Mobile Menu Toggle -->
				<div class="navbar-end">
					{/* Desktop actions */}
					<div class="hidden lg:flex gap-2 items-center">
						{
							socialLinks.map(({ href, label, icon: Icon }) => (
								<a
									href={href}
									target="_blank"
									rel="noopener noreferrer"
									aria-label={label}
									class="btn btn-ghost btn-circle"
								>
									<Icon class="w-5 h-5" />
								</a>
							))
						}
						<a href="/contact" class="btn bg-white">
							{currentLocale === "es" ? "Contáctanos" : "Contact us"}
						</a>
					</div>
					{/* Mobile menu toggle */}
					<div class="lg:hidden">
						<label
							for="my-drawer-3"
							aria-label="open sidebar"
							class="btn btn-square btn-ghost"
						>
							<Menu class="w-6 h-6" />
						</label>
					</div>
				</div>
			</div>
		</header>
		<!-- Page content will be rendered here by Astro -->
		<slot />
	</div>
	<div class="drawer-side z-50">
		<label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"
		></label>

		<ul class="menu bg-base-200 min-h-full w-72 p-4">
			<a
				href={currentLocale === "es" ? "/" : "/en"}
				aria-label="Grobles Home"
				class="flex items-center mb-4"
			>
				<img
					src="/grobles.png"
					alt="Grobles Logo"
					class="size-14 rounded-lg object-cover"
					loading="lazy"
					decoding="async"
				/>
				<span class="font-bold text-xl font-poppins text-base-content">
					{SITE_TITLE}
				</span>
			</a>
			<!-- Sidebar content here -->
			{
				navLinks.map(({ href, label }) => (
					<li>
						<a
							href={href}
							class={`px-4 py-2 rounded-lg text-lg font-semibold ${
								Astro.url.pathname === href
									? "bg-primary/10 text-primary font-semibold"
									: "hover:bg-base-200 text-base-content"
							}`}
							aria-current={Astro.url.pathname === href ? "page" : undefined}
						>
							{label}
						</a>
					</li>
				))
			}
			<li>
				<a
					href="/contact"
					class="btn btn-primary mt-4 btn-lg w-full font-semibold"
				>
					{currentLocale === "es" ? "Contáctanos" : "Contact us"}
				</a>
			</li>
			<li class="flex flex-row gap-2 justify-center pt-2">
				{
					socialLinks.map(({ href, label, icon: Icon }) => (
						<a
							href={href}
							target="_blank"
							rel="noopener noreferrer"
							aria-label={label}
							class="btn btn-ghost btn-circle btn-sm"
						>
							<Icon class="w-4 h-4" />
						</a>
					))
				}
			</li>
		</ul>
	</div>
</div>

<script>
	const header = document.getElementById("main-header");
	const drawerCheckbox = document.getElementById(
		"my-drawer-3",
	) as HTMLInputElement;

	if (header) {
		let lastScrollY = window.scrollY;

		const handleScroll = () => {
			const currentScrollY = window.scrollY;

			if (currentScrollY > lastScrollY && currentScrollY > 100) {
				header.classList.add("-translate-y-full");
				if (drawerCheckbox) {
					drawerCheckbox.checked = false;
				}
			} else {
				header.classList.remove("-translate-y-full");
			}
			lastScrollY = currentScrollY;
		};

		window.addEventListener("scroll", handleScroll);
	}
</script>
